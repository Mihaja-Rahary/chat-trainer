<!-- Fichier: pages/app.html -->
<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Chatter</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
<style>
body { margin:0; font-family:'Roboto',sans-serif; background:#fff0f5; }
header { padding:20px; background:#ff5f6d; color:#fff; font-size:22px; font-weight:700; display:flex; justify-content:space-between; align-items:center; }
#chat { padding:20px; height:70vh; overflow-y:auto; }
.message { padding:10px; margin:10px 0; border-radius:10px; max-width:70%; }
.message.user { background:#ff5f6d; color:#fff; margin-left:auto;}
.message.bot { background:#f0f0f0; color:#333; margin-right:auto;}
input { width:80%; padding:10px; border-radius:8px; border:1px solid #ccc; }
button { padding:10px; border-radius:8px; border:none; background:#ff5f6d; color:#fff; cursor:pointer; }
</style>
</head>
<body>

<header>
  <span id="welcome">Bienvenue !</span>
  <button onclick="logout()">DÃ©connexion</button>
</header>

<div id="chat"></div>
<div style="display:flex;padding:10px;">
  <input type="text" id="msgInput" placeholder="Ã‰crire un message..."/>
  <button onclick="sendMessage()">Envoyer</button>
</div>

<script>
const username = localStorage.getItem("username");
const role = localStorage.getItem("role");
if(!username || !role){ window.location.href="login.html"; }

document.getElementById("welcome").innerText = `Salut ${username} !`;

const chatDiv = document.getElementById("chat");
const pseudoPool = ["Alex","Sam","Max","LÃ©o","Tom","Lucas","Nico","Jules"];

function addMessage(text,sender){
  const div = document.createElement("div");
  div.className = `message ${sender}`;
  div.innerText = text;
  chatDiv.appendChild(div);
  chatDiv.scrollTop = chatDiv.scrollHeight;
}

function sendMessage(){
  const msg = document.getElementById("msgInput").value;
  if(!msg) return;
  addMessage(msg,"user");
  document.getElementById("msgInput").value="";
  setTimeout(()=>{ simulateBot(); },500 + Math.random()*500);
}

function simulateBot(){
  const pseudo = pseudoPool[Math.floor(Math.random()*pseudoPool.length)];
  const msgs = [
    `Salut ! C'est ${pseudo}, comment tu vas ?`,
    `Tu veux discuter un peu avec moi ? ðŸ˜‰`,
    `J'adore parler de toi, raconte-moi tout...`,
    `Je me demandais ce que tu faisais aujourd'hui ðŸ˜`
  ];
  addMessage(msgs[Math.floor(Math.random()*msgs.length)],"bot");
}

function logout(){
  localStorage.clear();
  window.location.href="login.html";
}

// Ajout de tips GFE en flottant
setInterval(()=>{
  const tips = [
    "Astuce: fais des questions ouvertes pour chauffer le client ðŸ˜‰",
    "Petit tip: rebondis toujours sur ce que le client dit",
    "Conseil: varie tes relances pour maintenir l'intÃ©rÃªt"
  ];
  addMessage(tips[Math.floor(Math.random()*tips.length)],"bot");
},20000);
</script>

</body>
</html>
